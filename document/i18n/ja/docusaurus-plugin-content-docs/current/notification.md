# 記事更新通知
WordPressに投稿された記事の更新通知をLINEユーザーに送信する方法です。

## LINE投稿手順
### 通知する投稿タイプの選択
1. 投稿通知タブの投稿タイプより、通知したい投稿タイプを選択して設定しておきます。カスタム投稿タイプにも対応しています。

### 投稿時
1. 投稿画面で、右カラムに「LINE Connect」ボックスが表示されるので、通知したい場合は「更新通知を送信する」へチェックを入れます。  
※チェックが入っていると新規投稿だけでなく更新する場合でも通知が行われます。  
※「予約投稿時に送信する」にチェックを入れて保存すると、予約投稿が公開された時にLINE通知が行われます。  
2. 画像付きで通知させたい場合は、アイキャッチ画像を設定してください。
3. 「送信対象」リストからLINEで通知するユーザーを「すべての友達」「連携済みの友達」、連携済みの友達のうち各ロールに属するユーザーから選択してください。（複数選択可能）
4. 「メッセージテンプレート」リストから、使用するテンプレートを選択してください。デフォルトテンプレートの場合は設定画面で大まかなデザインや色を調整できます。  
その他のテンプレートの場合は、自分でメッセージを組み立てることで細かなところまでカスタマイズを行えます。

### メッセージテンプレートとしてLCメッセージを使う場合使用できる変数
|変数名|内容|
|----:|----|
|`{{formatted_title}}`|投稿タイトル|
|`{{formatted_content}}`|タグや改行などを取り除いた本文先頭500文字|
|`{{post_thumbnail}}`|アイキャッチ画像URL|
|`{{post_permalink}}`|投稿パーマリンク|
|`{{link_label}}`|「もっと読む」ラベル|
|`{{alttext}}`|タイトル、本文、リンクを結合した先頭400文字|

#### WP_Postオブジェクトのプロパティ
[WP_Post](https://developer.wordpress.org/reference/classes/wp_post/)オブジェクトの各プロパティも変数として使用できます。  
例)
|変数名|内容|
|----:|----|
|`{{post_date}}`|投稿日時|
|`{{post_excerpt}}`|投稿の抜粋|
|`{{post_category.0}}`|1つ目のカテゴリーID|
|`{{post_category.1}}`|2つ目のカテゴリーID|
|`{{tags_input.0}}`|1つ目のタグ|

#### カスタムフィールドの値
投稿のカスタムフィールドの値も`{{post_meta.カスタムフィールド名}}`で使用できます。


### REST APIからのチャネル・ロール指定方法
REST APIから記事投稿する際にLINE ConnectにてLINE通知させたい場合は以下のキー＆値をJSONデータに加えてください。
```
  "lc_channels":{
      "(通知させたいチャネルのシークレットの先頭4文字)":{
        "roles": ["ロール名1", "ロール名2"],
        "template": LCメッセージの投稿ID(デフォルトテンプレートの場合は0)
      }
  }
```

バージョン3.2.1以前の場合は以下のフォーマットです。
```
  "lc_channels":{
      "(通知させたいチャネルのシークレットの先頭4文字)":"ロール名（複数ある場合は「,」で区切る）"
  }
```


## スクリーンショット
友達登録しているユーザーへはこのようにLINEのメッセージが表示されます。  
<img src="https://blog.shipweb.jp/wp-content/uploads/2021/03/PNG-imageposttoline.png" width="320"></img>  
リンクテキストや背景色、サムネのアスペクト比をカスタマイズすることも可能です。  
<img src="https://blog.shipweb.jp/wp-content/uploads/2021/03/PNG-imageposttolinecustom.png" width="320"></img>  